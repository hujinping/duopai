{"version":3,"sources":["RankingCell.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RankingCell extends cc.Component {\r\n\r\n    @property(cc.Sprite)\r\n    sprBg: cc.Sprite = null;\r\n    @property(cc.Sprite)\r\n    sprMedal: cc.Sprite = null;\r\n    @property(cc.Sprite)\r\n    sprHead: cc.Sprite = null;\r\n    @property(cc.Label)\r\n    lbRank: cc.Label = null;\r\n    @property(cc.Label)\r\n    lbName: cc.Label = null;\r\n    @property(cc.Label)\r\n    lbScore: cc.Label = null;\r\n    @property(cc.Label)\r\n    lbGrade: cc.Label = null;\r\n    @property(cc.Label)\r\n    lbtitle: cc.Label = null;\r\n    @property([cc.SpriteFrame])\r\n    medalFrames: cc.SpriteFrame[] = [];\r\n    @property([cc.SpriteFrame])\r\n    bgFrames: cc.SpriteFrame[] = [];\r\n\r\n    private gradeList = [\"王\\n者\", \"宗\\n师\", \"大\\n师\", \"进\\n阶\", \"入\\n门\", \"渣\\n渣\"];\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    // onLoad () {}\r\n\r\n    setData(rank, data, boolSetBg) {\r\n        this.createImage(data.avatarUrl);\r\n        this.lbName.string = this.cutstr(data.nickname, 10);\r\n        this.setMedal(rank);\r\n        if (boolSetBg) {\r\n            this.setBg(rank);\r\n        }\r\n        if (!data.KVDataList) {\r\n            return;\r\n        }\r\n        let score = data.KVDataList.length != 0 ? data.KVDataList[0].value : 0;\r\n        this.lbScore.string = score;\r\n    }\r\n\r\n    setOverData(rank, data) {\r\n        if (!data.KVDataList) {\r\n            return;\r\n        }\r\n        this.createImage(data.avatarUrl);\r\n        this.lbName.string = this.cutstr(data.nickname, 10);\r\n        this.setMedal(rank);\r\n\r\n        let idx = rank % 2;\r\n        if (idx == 0) this.sprBg.spriteFrame = this.bgFrames[idx];\r\n        else this.sprBg.spriteFrame = null;\r\n\r\n        let score = data.KVDataList.length != 0 ? data.KVDataList[0].value : 0;\r\n        this.lbScore.string = score;\r\n\r\n        return this.setLbGrade(score);\r\n    }\r\n\r\n    setSelfOverData(data) {\r\n        if (!data.KVDataList) {\r\n            return;\r\n        }\r\n        this.createImage(data.avatarUrl);\r\n        this.lbName.string = this.cutstr(data.nickname, 10);\r\n        let score = data.KVDataList.length != 0 ? data.KVDataList[0].value : 0;\r\n        this.setLbGrade(score);\r\n    }\r\n\r\n    setLbGrade(score) {\r\n        let lb = this.lbGrade.getComponent(cc.Label);\r\n        if (score < 2000) {\r\n            lb.string = this.gradeList[5];\r\n            return 5;\r\n        } else if (score >= 2000 && score < 10000) {\r\n            lb.string = this.gradeList[4];\r\n            return 4;\r\n        } else if (score >= 10000 && score < 30000) {\r\n            lb.string = this.gradeList[3];\r\n            return 3;\r\n        } else if (score >= 30000 && score < 50000) {\r\n            lb.string = this.gradeList[2];\r\n            return 2;\r\n        } else if (score >= 50000 && score < 80000) {\r\n            lb.string = this.gradeList[1];\r\n            return 1;\r\n        } else if (score >= 100000) {\r\n            lb.string = this.gradeList[0];\r\n            return 0;\r\n        }\r\n    }\r\n\r\n    setTitle(string) {\r\n        this.sprBg.node.active = false;\r\n        this.lbtitle.getComponent(cc.Label).string = string;\r\n    }\r\n\r\n    setBg(idx) {\r\n        idx = 0;\r\n        this.sprBg.spriteFrame = this.bgFrames[idx];\r\n    }\r\n\r\n    setMedal(idx) {\r\n        if (idx < 3) {\r\n            this.sprMedal.node.active = true;\r\n            this.sprMedal.spriteFrame = this.medalFrames[idx];\r\n            this.lbRank.node.active = false;\r\n        } else {\r\n            this.lbRank.node.active = true;\r\n            this.lbRank.string = idx + 1;\r\n            this.sprMedal.node.active = false;\r\n        }\r\n    }\r\n\r\n    createImage(avatarUrl) {\r\n        if (window.wx != undefined) {\r\n            try {\r\n                let image = wx.createImage();\r\n                image.onload = () => {\r\n                    try {\r\n                        let texture = new cc.Texture2D();\r\n                        texture.initWithElement(image);\r\n                        texture.handleLoadedTexture();\r\n                        this.sprHead.spriteFrame = new cc.SpriteFrame(texture);\r\n                    } catch (e) {\r\n                        cc.log(e);\r\n                        this.sprHead.node.active = false;\r\n                    }\r\n                };\r\n                image.src = avatarUrl;\r\n            } catch (e) {\r\n                cc.log(e);\r\n                this.sprHead.node.active = false;\r\n            }\r\n        } else {\r\n            cc.loader.load({\r\n                url: avatarUrl,\r\n                type: 'jpg'\r\n            }, (err, texture) => {\r\n                this.sprHead.spriteFrame = new cc.SpriteFrame(texture);\r\n            });\r\n        }\r\n    }\r\n\r\n    //裁剪字符串，超出指定长度之后显示...(每个中文字符长度为2）\r\n    cutstr(str, len) {\r\n        let str_length = 0;\r\n        let str_len = 0;\r\n        let str_cut = new String();\r\n        str_len = str.length;\r\n        for (var i = 0; i < str_len; i++) {\r\n            let a = str.charAt(i);\r\n            str_length++;\r\n            if (escape(a).length > 4) {\r\n                //中文字符的长度经编码之后大于4 \r\n                str_length++;\r\n            }\r\n            str_cut = str_cut.concat(a);\r\n            if (str_length > len) {\r\n                str_cut = str_cut.concat(\"...\");\r\n                return str_cut;\r\n            }\r\n        }\r\n        // //如果给定字符串小于指定长度，则返回源字符串； \r\n        // if (str_length < len) {\r\n        //     return str;\r\n        // }\r\n        return str;\r\n    }\r\n\r\n    // start () {\r\n\r\n    // }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}