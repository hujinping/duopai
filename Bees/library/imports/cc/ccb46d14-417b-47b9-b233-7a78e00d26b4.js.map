{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\UI\\ranking/assets\\Script\\UI\\ranking\\RankingView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\UI\\ranking","sourcesContent":["//排行榜界面\r\n\r\nimport RankingCell from \"./RankingCell\";\r\nimport GameCtr from \"../../Controller/GameCtr\";\r\nimport WXCtr from \"../../Controller/WXCtr\";\r\nimport Http from \"../../Common/Http\";\r\nimport UserManager from \"../../Common/UserManager\";\r\nimport AudioManager from \"../../Common/AudioManager\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class RankingView extends cc.Component {\r\n    @property(cc.Node)\r\n    ndRanking: cc.Node = null\r\n    @property(cc.Sprite)\r\n    sprFreindRankScroll: cc.Sprite = null;\r\n    @property(cc.Node)\r\n    ndWorldScr: cc.Node = null;\r\n    @property(cc.Node)\r\n    ndWorldContent: cc.Node = null;\r\n    @property(cc.Prefab)\r\n    pfCell: cc.Prefab = null;\r\n    @property(cc.Toggle)\r\n    friendToggle: cc.Toggle = null;\r\n    @property(cc.Toggle)\r\n    worldToggle: cc.Toggle = null;\r\n    @property(cc.Node)\r\n    ndAuthTip: cc.Node = null;\r\n    @property(cc.Node)\r\n    btn_pageUp :cc.Node=null;\r\n    @property(cc.Node)\r\n    btn_pageDown:cc.Node=null;\r\n    @property(cc.Node)\r\n    btn_share :cc.Node=null;\r\n    @property(cc.Node)\r\n    btn_joinRank:cc.Node=null;\r\n\r\n\r\n    @property(cc.Sprite)\r\n    headImg :cc.Sprite=null;\r\n    @property(cc.Label)\r\n    lb_name:cc.Label=null;\r\n    @property(cc.Label)\r\n    lb_location:cc.Label=null;\r\n    private worldListData=[];\r\n    private isGetWorldList = false;\r\n    private curPageIndex=0;\r\n    private isShowFrenidRank=false;\r\n    onLoad() {\r\n        GameCtr.getInstance().setRanking(this);\r\n        this.btn_share.active=GameCtr.isAudited;\r\n    }\r\n\r\n    start() {\r\n        if(window.wx != undefined){\r\n            this.tex = new cc.Texture2D();\r\n            window.sharedCanvas.width = 900;\r\n            window.sharedCanvas.height = 1200;\r\n        }\r\n\r\n        this.initRank();\r\n        this.initSelfInfo();\r\n    }\r\n\r\n    //初始化界面\r\n    initRank() {\r\n        if (this.friendToggle.isChecked) {\r\n            this.curPageIndex=0;\r\n            this.showFreindRanking();\r\n        } else if (this.worldToggle.isChecked) {\r\n            this.curPageIndex=0;\r\n            this.showWorldRanking();\r\n        }\r\n    }\r\n\r\n    initSelfInfo(){\r\n        if(UserManager.user){\r\n            this.loadImg(this.headImg,UserManager.user.icon);\r\n            let name=UserManager.user.nick?UserManager.user.nick:\"游客\";\r\n            let city=UserManager.user.city?UserManager.user.city:\"未知\";\r\n            this.lb_name.string=name;\r\n            this.lb_location.string=city;\r\n        }\r\n    }\r\n\r\n    //返回结束\r\n    back() {\r\n        AudioManager.getInstance().playSound(\"audio/btnClose\");\r\n        this.showAuthTip(false);\r\n        this.node.parent.destroy();\r\n    }\r\n\r\n    //显示世界排行\r\n    showWorldRanking() {\r\n        console.log('点击了世界排行榜');\r\n        this.curPageIndex=0;\r\n        this.ndWorldScr.active = true;\r\n        this.sprFreindRankScroll.node.active = false;\r\n        if (!WXCtr.authed) {\r\n            console.log(\"未授权，引导获取授权！！！\");\r\n            this.btn_joinRank.active=true; \r\n        }else{\r\n            this.btn_joinRank.active=false; \r\n        }\r\n        if (!this.isGetWorldList) {\r\n            this.getWorldRankingData();\r\n        }else{\r\n            this.showRanklist(this.ndWorldScr,this.worldListData,this.curPageIndex);\r\n        }\r\n    }\r\n\r\n    onBtnPageUp(){\r\n        AudioManager.getInstance().playSound(\"audio/open_panel\");\r\n        if(this.curPageIndex==0){return}\r\n        this.curPageIndex--\r\n        if(this.ndWorldScr.active){\r\n            this.showRanklist(this.ndWorldScr,this.worldListData,this.curPageIndex);\r\n        }\r\n\r\n        if(this.sprFreindRankScroll.node.active){\r\n            WXCtr.showFriendRanking(this.curPageIndex);\r\n            this.scheduleOnce(function() { //重点\r\n                if (this.tex) {\r\n                    this.tex.initWithElement(window.sharedCanvas);\r\n                    this.tex.handleLoadedTexture();\r\n                    this.sprFreindRankScroll.spriteFrame= new cc.SpriteFrame(this.tex);\r\n                }\r\n            }, 1);\r\n        } \r\n    }\r\n\r\n    onBtnPageDown(){\r\n        AudioManager.getInstance().playSound(\"audio/open_panel\");\r\n        if(this.ndWorldScr.active){\r\n            if((this.curPageIndex+1)*7>=this.worldListData.length){return;}\r\n        }\r\n\r\n        \r\n        this.curPageIndex++\r\n        if(this.ndWorldScr.active){\r\n            this.showRanklist(this.ndWorldScr,this.worldListData,this.curPageIndex);\r\n        }\r\n\r\n        if(this.sprFreindRankScroll.node.active){\r\n            WXCtr.showFriendRanking(this.curPageIndex);\r\n            this.scheduleOnce(function() { //重点\r\n                if (this.tex) {\r\n                    this.tex.initWithElement(window.sharedCanvas);\r\n                    this.tex.handleLoadedTexture();\r\n                    this.sprFreindRankScroll.spriteFrame= new cc.SpriteFrame(this.tex);\r\n                }\r\n            },1);\r\n        }\r\n    }\r\n\r\n    onBtnJoinRank(){\r\n        AudioManager.getInstance().playSound(\"audio/open_panel\");\r\n        this.showAuthTip(true);\r\n    }\r\n\r\n    onBtnShare(){\r\n        AudioManager.getInstance().playSound(\"audio/open_panel\");\r\n        WXCtr.share();\r\n    }\r\n\r\n    showRanklist(parent,rankList,index=0){\r\n        this.curPageIndex=index;\r\n        parent.removeAllChildren();\r\n        let startIndex=index*7;\r\n        let endIndex=(index*7+7)>rankList.length?rankList.length:(index*7+7);\r\n        for(let i=startIndex;i<endIndex;i++){\r\n            let off_y=i%7>=3?-35:0;\r\n            let nd = cc.instantiate(this.pfCell);\r\n            parent.addChild(nd);\r\n            nd.x=2;\r\n            nd.y=530+(i%7)*(-132)+off_y;\r\n            let rankingCell: RankingCell = nd.getComponent(RankingCell);\r\n            rankingCell.setData(i+1, rankList[i]);\r\n        }\r\n    }\r\n\r\n    showAuthTip(isShow = false) {\r\n        this.ndAuthTip.active = isShow;\r\n        if(isShow) {\r\n            WXCtr.userInfoBtn.show();\r\n        }else{\r\n            WXCtr.userInfoBtn.hide();\r\n        }\r\n    }\r\n\r\n    //获取世界排行数据\r\n    getWorldRankingData() {\r\n        Http.send({\r\n            url: Http.UrlConfig.GET_RANK_LIST,\r\n            success: (resp) => {\r\n                console.log(\"getWorldList response == \", resp);\r\n                this.isGetWorldList = true;\r\n                this.setWorldList(resp.data);\r\n            },\r\n            data: {\r\n                uid: UserManager.user_id,\r\n                voucher:UserManager.voucher,\r\n            }\r\n        });\r\n    }\r\n\r\n    //设置世界排行\r\n    setWorldList(list) {\r\n        for(let i in list){\r\n            this.worldListData.push(list[i])\r\n        }\r\n        this.showRanklist(this.ndWorldScr,this.worldListData,0);\r\n    }\r\n\r\n    //设置世界排行自己数据\r\n    setSelfWorldData(rank, data) {\r\n        let nd = this.ndWorldScr.getChildByName(\"SelfRanking\");\r\n        nd.active = true;\r\n        let rankingCell: RankingCell = nd.getComponent(RankingCell);\r\n        rankingCell.setData(rank, data);\r\n    }\r\n\r\n    //显示好友排行\r\n    showFreindRanking() {\r\n        this.curPageIndex=0;\r\n        this.sprFreindRankScroll.node.active = true;\r\n        this.ndWorldScr.active = false;\r\n        this.showAuthTip(false);\r\n        WXCtr.showFriendRanking(this.curPageIndex);\r\n        if(!this.isShowFrenidRank){\r\n            window.sharedCanvas.width = 1080;\r\n            window.sharedCanvas.height = 1920;\r\n            this.scheduleOnce(function() { //重点\r\n                if (this.tex) {\r\n                    this.tex.initWithElement(window.sharedCanvas);\r\n                    this.tex.handleLoadedTexture();\r\n                    this.sprFreindRankScroll.spriteFrame= new cc.SpriteFrame(this.tex);\r\n                }\r\n            }, 1);\r\n            this.isShowFrenidRank=true;\r\n        }\r\n    }\r\n\r\n    loadImg(spr, imgUrl) {\r\n        if(!imgUrl||imgUrl==\"\"){return;}\r\n        cc.loader.load({\r\n            url: imgUrl,\r\n            type: 'jpg'\r\n        }, (err, texture) => {\r\n            spr.spriteFrame = new cc.SpriteFrame(texture);\r\n        });\r\n    }\r\n\r\n    //关闭世界排行\r\n    onCloseRank() {\r\n        this.ndRanking.active = false;\r\n    }\r\n};"]}