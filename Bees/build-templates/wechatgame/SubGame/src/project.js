require=function r(i,s,l){function c(t,e){if(!s[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(p)return p(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[t]={exports:{}};i[t][0].call(o.exports,function(e){return c(i[t][1][e]||e)},o,o.exports,r,i,s,l)}return s[t].exports}for(var p="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({CanvasCtr:[function(e,t,a){"use strict";cc._RF.push(t,"5dd8fAmjN5ItpUb3XWnz0dS","CanvasCtr"),Object.defineProperty(a,"__esModule",{value:!0});var n,o,r=e("./Ranking"),i=e("./RankingCell"),s=cc._decorator,l=s.ccclass,c=s.property;(o=n||(n={}))[o.Get_SelfData=0]="Get_SelfData",o[o.Get_FriendData=1]="Get_FriendData",o[o.Get_GroupData=2]="Get_GroupData",o[o.Submit_SelfScore=3]="Submit_SelfScore",o[o.Compare_Score=4]="Compare_Score",o[o.Show_WholeRanking=5]="Show_WholeRanking",o[o.Show_OverRanking=6]="Show_OverRanking",o[o.Close_WholeRanking=7]="Close_WholeRanking",o[o.Close_OverRanking=8]="Close_OverRanking";var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ndFriend=null,e.scrRanking=null,e.ndOverRanking=null,e.overCells=[],e.ndsurpass=null,e.mSelfData=null,e.mSelfRank=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.handleWxMessage()},e.prototype.handleWxMessage=function(){var t=this;null!=window.wx&&window.wx.onMessage(function(e){e.messageType==n.Get_FriendData?t.getFriendData(e.LIST_KEY):e.messageType==n.Get_GroupData?t.getGroupData(e.LIST_KEY,e.shareTicket):e.messageType==n.Submit_SelfScore?t.submitScore(e.score,e.LIST_KEY):e.messageType==n.Compare_Score?t.compareWithScore(e.score):e.messageType==n.Show_WholeRanking?t.showFriendRanking(e.pageIndex):e.messageType==n.Show_OverRanking?t.showOverRanking():e.messageType==n.Get_SelfData?t.getSelfData():e.messageType==n.Close_WholeRanking?t.closeFriendRanking():(e.messageType=n.Close_OverRanking)&&t.closeOverRanking()})},e.prototype.onDestroy=function(){},e.prototype.getSelfData=function(){var a=this;console.log("获取自己信息！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("获取自己信息成功！！！！！！！！！！！！！",e);var t=e.data[0];a.mSelfData=t},fail:function(e){console.log("获取自己信息失败！！！！！！！！！！！！！")}})},e.prototype.getFriendData=function(e,t){var a=this;void 0===t&&(t=!1),console.log("获取好友排行榜数据！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getFriendCloudStorage({keyList:[e],success:function(e){console.log("获取好友排行榜数据成功"),console.log("wx.getFriendCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),a.mFriendRankData=t,a.getSelfRank()},fail:function(e){console.log("获取好友排行榜数据失败")}})},e.prototype.getGroupData=function(t,a){var n=this;null!=window.wx&&window.wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){window.wx.getGroupCloudStorage({shareTicket:a,keyList:[t],success:function(e){console.log("wx.getGroupCloudStorage success",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),n.mGroupData=t},fail:function(e){console.log("wx.getFriendCloudStorage fail",e)}})}})},e.prototype.submitScore=function(t,a){var n=this;console.log("提交分数"),null!=window.wx?window.wx.getUserCloudStorage({keyList:[a],success:function(e){console.log("提交分数成功",e),0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:a,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("提交分数失败","fail")},complete:function(e){console.log("提交分数完成","ok"),n.getFriendData("Rank_Data",!0)}}):cc.log("提交得分:"+a+" : "+t)},e.prototype.compareWithScore=function(e){if(this.mFriendRankData){console.log("this.mFriendRankData =========",this.mFriendRankData),console.log("this.mSelfRank ============",this.mSelfRank);for(var t=0;t<this.mFriendRankData.length;t++){(a=this.mFriendRankData[t]).avatarUrl==this.mSelfData.avatarUrl&&(a.KVDataList[0].value=e)}this.mFriendRankData.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),this.mSelfRank=this.getSelfRank(),this.ndOverRanking.active=!1,this.ndFriend.active=!1;for(t=0;t<this.mFriendRankData.length;t++){var a=this.mFriendRankData[t];if(t==this.mSelfRank-1)return this.ndsurpass.active=!0,void this.createImage(a.avatarUrl,this.ndsurpass.getChildByName("image").getComponent(cc.Sprite))}}else console.log("没有好友排行榜信息，请先获取好友排行榜信息")},e.prototype.CloseCompareWithScore=function(){this.ndsurpass.active=!1},e.prototype.createImage=function(e,a){if(null!=window.wx)try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),a.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),a.node.active=!1}},t.src=e}catch(e){cc.log(e),a.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){a.spriteFrame=new cc.SpriteFrame(t)})},e.prototype.showFriendRanking=function(e){this.CloseCompareWithScore(),this.ndFriend.active=!0,this.ndOverRanking.active=!1,this.scrRanking.node.active=!0,console.log("显示好友排行榜",this.mFriendRankData),this.mFriendRankData?this.scrRanking.loadRanking(this.mFriendRankData,e):console.log("没有好友排行榜信息，请先获取好友排行榜信息")},e.prototype.closeFriendRanking=function(){this.scrRanking.clear(),this.ndFriend.active=!1,this.ndOverRanking.active=!0,this.CloseCompareWithScore()},e.prototype.showOverRanking=function(){},e.prototype.closeOverRanking=function(){this.ndOverRanking.active=!1,this.CloseCompareWithScore()},e.prototype.getSelfRank=function(){var e=0;if(this.mSelfData)for(var t=0;t<this.mFriendRankData.length;t++){var a=this.mFriendRankData[t];a.avatarUrl==this.mSelfData.avatarUrl&&(e=t,this.mSelfData=a)}return e},__decorate([c(cc.Node)],e.prototype,"ndFriend",void 0),__decorate([c(r.default)],e.prototype,"scrRanking",void 0),__decorate([c(cc.Node)],e.prototype,"ndOverRanking",void 0),__decorate([c([i.default])],e.prototype,"overCells",void 0),__decorate([c(cc.Node)],e.prototype,"ndsurpass",void 0),e=__decorate([l],e)}(cc.Component);a.default=p,cc._RF.pop()},{"./Ranking":"Ranking","./RankingCell":"RankingCell"}],RankingCell:[function(e,t,a){"use strict";cc._RF.push(t,"61afc7jnvBPqLy8NzGSRn2f","RankingCell"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,r=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprBg=null,e.sprMedal=null,e.sprHead=null,e.lbRank=null,e.lbName=null,e.lbScore=null,e.medalFrames=[],e.bgFrames=[],e}return __extends(e,t),e.prototype.setData=function(e,t){if(this.createImage(t.avatarUrl),this.lbName.string=this.cutstr(t.nickname,10),this.setMedal(e),t.KVDataList){var a=0!=t.KVDataList.length?t.KVDataList[0].value:0;this.lbScore.string=this.formatNumber(Number(a))+""}},e.prototype.setBg=function(e){e%=2,this.sprBg.spriteFrame=this.bgFrames[e]},e.prototype.setMedal=function(e){e<3?(this.sprMedal.node.active=!0,this.sprMedal.spriteFrame=this.medalFrames[e],this.lbRank.node.active=!1):(this.lbRank.node.active=!0,this.lbRank.string=e+1,this.sprMedal.node.active=!1)},e.prototype.createImage=function(e){var a=this;if(null!=window.wx)try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),a.sprHead.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),a.sprHead.node.active=!1}},t.src=e}catch(e){cc.log(e),this.sprHead.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){a.sprHead.spriteFrame=new cc.SpriteFrame(t)})},e.prototype.cutstr=function(e,t){var a,n=0,o=new String;a=e.length;for(var r=0;r<a;r++){var i=e.charAt(r);if(n++,4<escape(i).length&&n++,o=o.concat(i),t<n)return o=o.concat("...")}return e},e.prototype.formatNumber=function(e){return e>Math.pow(10,33)?(e/Math.pow(10,33)).toFixed(1)+"gg":e>Math.pow(10,30)?(e/Math.pow(10,30)).toFixed(1)+"ff":e>Math.pow(10,27)?(e/Math.pow(10,27)).toFixed(1)+"ee":e>Math.pow(10,24)?(e/Math.pow(10,24)).toFixed(1)+"dd":e>Math.pow(10,21)?(e/Math.pow(10,21)).toFixed(1)+"cc":e>Math.pow(10,18)?(e/Math.pow(10,18)).toFixed(1)+"bb":e>Math.pow(10,15)?(e/Math.pow(10,15)).toFixed(1)+"aa":e>Math.pow(10,12)?(e/Math.pow(10,12)).toFixed(1)+"T":e>Math.pow(10,9)?(e/Math.pow(10,9)).toFixed(1)+"B":e>Math.pow(10,6)?(e/Math.pow(10,6)).toFixed(1)+"M":e>Math.pow(10,3)?(e/Math.pow(10,3)).toFixed(1)+"K":e},__decorate([r(cc.Sprite)],e.prototype,"sprBg",void 0),__decorate([r(cc.Sprite)],e.prototype,"sprMedal",void 0),__decorate([r(cc.Sprite)],e.prototype,"sprHead",void 0),__decorate([r(cc.Label)],e.prototype,"lbRank",void 0),__decorate([r(cc.Label)],e.prototype,"lbName",void 0),__decorate([r(cc.Label)],e.prototype,"lbScore",void 0),__decorate([r([cc.SpriteFrame])],e.prototype,"medalFrames",void 0),__decorate([r([cc.SpriteFrame])],e.prototype,"bgFrames",void 0),e=__decorate([o],e)}(cc.Component);a.default=i,cc._RF.pop()},{}],Ranking:[function(e,t,a){"use strict";cc._RF.push(t,"f4f54uObghLbJK7HnlIlACQ","Ranking"),Object.defineProperty(a,"__esModule",{value:!0});var l=e("./RankingCell"),n=cc._decorator,o=n.ccclass,r=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ndContent=null,e.pfCell=null,e}return __extends(e,t),e.prototype.loadRanking=function(e,t){if(!(7*t>=e.length)){this.ndContent.removeAllChildren();for(var a=7*t,n=7*t+7>e.length?e.length:7*t+7,o=a;o<n;o++){var r=3<=o%7?-35:0,i=cc.instantiate(this.pfCell);this.ndContent.addChild(i),i.x=2,i.y=672+o%7*-132+r;var s=e[o];i.getComponent(l.default).setData(o,s)}}},e.prototype.clear=function(){this.ndContent.removeAllChildren()},e.prototype.onLoad=function(){},e.prototype.start=function(){},__decorate([r(cc.Node)],e.prototype,"ndContent",void 0),__decorate([r(cc.Prefab)],e.prototype,"pfCell",void 0),e=__decorate([o],e)}(cc.Component);a.default=i,cc._RF.pop()},{"./RankingCell":"RankingCell"}]},{},["CanvasCtr","Ranking","RankingCell"]);