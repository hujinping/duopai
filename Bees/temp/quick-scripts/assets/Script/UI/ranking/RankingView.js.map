{"version":3,"sources":["RankingView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/Script/UI/ranking","sourcesContent":["//排行榜界面\n\nimport RankingCell from \"./RankingCell\";\nimport GameCtr from \"../../Controller/GameCtr\";\nimport WXCtr from \"../../Controller/WXCtr\";\nimport Http from \"../../Common/Http\";\nimport UserManager from \"../../Common/UserManager\";\n\nconst { ccclass, property } = cc._decorator;\n@ccclass\nexport default class RankingView extends cc.Component {\n    @property(cc.Node)\n    ndRanking: cc.Node = null\n    @property(cc.Sprite)\n    sprFreindRankScroll: cc.Sprite = null;\n    @property(cc.Node)\n    ndWorldScr: cc.Node = null;\n    @property(cc.Node)\n    ndWorldContent: cc.Node = null;\n    @property(cc.Prefab)\n    pfCell: cc.Prefab = null;\n    @property(cc.Toggle)\n    friendToggle: cc.Toggle = null;\n    @property(cc.Toggle)\n    worldToggle: cc.Toggle = null;\n    @property(cc.Node)\n    ndAuthTip: cc.Node = null;\n\n    private tex = null;\n    private isGetWorldList = false;\n    private isGetFriendList = false;\n    \n    onLoad() {\n        GameCtr.getInstance().setRanking(this);\n    }\n\n    start() {\n        if(window.wx != undefined){\n            this.tex = new cc.Texture2D();\n            window.sharedCanvas.width = 900;\n            window.sharedCanvas.height = 1200;\n        }\n        this.initRank();\n    }\n\n    //初始化界面\n    initRank() {\n        // if (this.friendToggle.isChecked) {\n        //     this.showFreindRanking();\n        // } else if (this.worldToggle.isChecked) {\n        //     this.showWorldRanking();\n        // }\n\n        this.showWorldRanking();\n    }\n\n    //返回结束\n    back() {\n        this.showAuthTip(false);\n        this.isGetFriendList = false;\n        WXCtr.closeFriendRanking();\n        GameCtr.gotoScene(GameCtr.rankingEntrance);\n    }\n\n    //显示世界排行\n    showWorldRanking() {\n        console.log('点击了世界排行榜');\n        this.ndWorldScr.active = true;\n        this.sprFreindRankScroll.node.active = false;\n        if (!WXCtr.wxLoginSuccess) {\n            console.log(\"未授权，引导获取授权！！！\");\n            this.showAuthTip(true);\n            return;\n        }\n        if (!this.isGetWorldList) {\n            this.getWorldRankingData();\n        }\n    }\n\n    //\n    showAuthTip(isShow = false) {\n        this.ndAuthTip.active = isShow;\n        if(isShow) {\n            WXCtr.userInfoBtn.show();\n        }else{\n            WXCtr.userInfoBtn.hide();\n        }\n    }\n\n    //获取世界排行数据\n    getWorldRankingData() {\n        console.log('获取世界排行数据???');\n        Http.send({\n            url: Http.UrlConfig.GET_RANK_LIST,\n            success: (resp) => {\n                console.log(\"getWorldList response == \", resp);\n                this.isGetWorldList = true;\n                this.setWorldList(resp.data,resp.metop,resp.metopvalue);\n            },\n            data: {\n                uid: UserManager.user_id,\n                voucher:UserManager.voucher,\n            }\n        });\n    }\n\n    //设置世界排行\n    setWorldList(worldRanks,selfRank,selfChickenValue) {\n        // UILoader.loadRes(\"prefab/totalRank\", cc.Prefab, (prefab) => {\n        //     UILoader.instantiate(prefab, this.node, (node) => {\n        //         node.getComponent(\"totalRank\").init(worldRanks,selfRank,selfChickenValue)\n        //     });\n        // });\n\n    }\n\n\n\n    //显示好友排行\n    showFreindRanking() {\n        this.sprFreindRankScroll.node.active = true;\n        this.ndWorldScr.active = false;\n        this.showAuthTip(false);\n        if (!this.isGetFriendList) {\n            this.isGetFriendList = true;\n            WXCtr.showFriendRanking();\n        }\n    }\n\n    //关闭世界排行\n    onCloseRank() {\n        this.ndRanking.active = false;\n    }\n\n\n    // 刷新子域的纹理\n    _updateSubDomainCanvas() {\n        if (window.sharedCanvas != undefined && this.tex != null && this.ndRanking.active && this.sprFreindRankScroll.node.active) {\n            this.tex.initWithElement(window.sharedCanvas);\n            this.tex.handleLoadedTexture();\n            this.sprFreindRankScroll.spriteFrame = new cc.SpriteFrame(this.tex);\n        }\n    }\n    update() {\n        this._updateSubDomainCanvas();\n    }\n};"]}