require=function r(i,c,s){function l(t,e){if(!c[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=c[t]={exports:{}};i[t][0].call(a.exports,function(e){return l(i[t][1][e]||e)},a,a.exports,r,i,c,s)}return c[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({CanvasCtr:[function(e,t,n){"use strict";cc._RF.push(t,"5dd8fAmjN5ItpUb3XWnz0dS","CanvasCtr"),Object.defineProperty(n,"__esModule",{value:!0});var o,a,r=cc._decorator,i=r.ccclass;r.property;(a=o||(o={}))[a.Get_SelfData=0]="Get_SelfData",a[a.Get_FriendData=1]="Get_FriendData",a[a.Get_GroupData=2]="Get_GroupData",a[a.Submit_SelfScore=3]="Submit_SelfScore",a[a.Compare_Score=4]="Compare_Score",a[a.Show_WholeRanking=5]="Show_WholeRanking",a[a.Show_OverRanking=6]="Show_OverRanking",a[a.Close_WholeRanking=7]="Close_WholeRanking",a[a.Close_OverRanking=8]="Close_OverRanking";var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mFriendRankData=null,e.rankNode=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.handleWxMessage(),this.rankNode=this.node.getChildByName("totalRank")},e.prototype.handleWxMessage=function(){var t=this;null!=window.wx&&window.wx.onMessage(function(e){e.messageType==o.Get_FriendData?t.getFriendData(e.LIST_KEY):e.messageType==o.Get_GroupData||(e.messageType==o.Submit_SelfScore?t.submitScore(e.score,e.LIST_KEY):e.messageType==o.Compare_Score||(e.messageType==o.Show_WholeRanking?t.showFriendRanking():e.messageType==o.Show_OverRanking||e.messageType==o.Get_SelfData||e.messageType==o.Close_WholeRanking||(e.messageType=o.Close_OverRanking)))})},e.prototype.getFriendData=function(e){var n=this;console.log("获取好友排行榜数据！！！！！！！！！！！！！"),null!=window.wx&&window.wx.getFriendCloudStorage({keyList:[e],success:function(e){console.log("获取好友排行榜数据成功");var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),n.mFriendRankData=t,n.rankNode.getComponent("Rank").initFriendRankData(t),console.log("log------好友榜数据 data=:",n.mFriendRankData)},fail:function(e){console.log("获取好友排行榜数据失败")}})},e.prototype.submitScore=function(t,n){var o=this;console.log("提交分数"),null!=window.wx?window.wx.getUserCloudStorage({keyList:[n],success:function(e){console.log("提交分数成功",e),0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:n,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("提交分数失败","fail")},complete:function(e){console.log("提交分数完成","ok"),o.getFriendData("Rank_Data")}}):cc.log("提交得分:"+n+" : "+t)},e.prototype.showFriendRanking=function(){console.log("log---------------子域showFriendRanking"),this.rankNode.getComponent("Rank").initRanks()},e=__decorate([i],e)}(cc.Component);n.default=c,cc._RF.pop()},{}],RankItem:[function(e,t,n){"use strict";cc._RF.push(t,"61afc7jnvBPqLy8NzGSRn2f","RankItem"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lb_rank=null,e.lb_name=null,e.lb_chickenCount=null,e.headImg=null,e}return __extends(e,t),e.prototype.setRank=function(e){this.lb_rank.string=e},e.prototype.setName=function(e){this.lb_name.string=e},e.prototype.setChickenCount=function(e){this.lb_chickenCount.string=e},e.prototype.setHeadImg=function(e){var n=this;if(null!=window.wx)try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),n.headImg.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),n.headImg.node.active=!1}},t.src=e}catch(e){cc.log(e),this.headImg.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){n.headImg.spriteFrame=new cc.SpriteFrame(t)})},e.prototype.cutstr=function(e,t){var n,o=0,a=new String;n=e.length;for(var r=0;r<n;r++){var i=e.charAt(r);if(o++,4<escape(i).length&&o++,a=a.concat(i),t<o)return a=a.concat("...")}return e},__decorate([r(cc.Label)],e.prototype,"lb_rank",void 0),__decorate([r(cc.Label)],e.prototype,"lb_name",void 0),__decorate([r(cc.Label)],e.prototype,"lb_chickenCount",void 0),__decorate([r(cc.Sprite)],e.prototype,"headImg",void 0),e=__decorate([a],e)}(cc.Component);n.default=i,cc._RF.pop()},{}],Rank:[function(e,t,n){"use strict";cc._RF.push(t,"75450aSCo9Lc7Qcm6lZ+wbg","Rank"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.rankContent=null,e.friendsData=[],e.rankItem=null,e.head=null,e}return __extends(e,t),e.prototype.onLoad=function(){this.initNode(),this.adaptScreen()},e.prototype.initNode=function(){var e=this.node.getChildByName("worldRankNode").getChildByName("rankNode");this.rankContent=e.getChildByName("scrollView").getChildByName("view").getChildByName("content")},e.prototype.adaptScreen=function(){var e=cc.director.getVisibleSize();this.node.getChildByName("worldRankNode").getChildByName("rankNode").y=e.height/2-600},e.prototype.initRanks=function(){this.initNormalRanks()},e.prototype.initFriendRankData=function(e){this.friendsData=e},e.prototype.initNormalRanks=function(){console.log("log----------this.friendData=:",this.friendsData),this.rankContent.setContentSize(cc.size(1080,200*this.friendsData.length+400));for(var e=0;e<this.friendsData.length;e++){var t=cc.instantiate(this.rankItem);t.parent=this.rankContent,t.y=-200*Number(e)-100,t.getComponent("RankItem").setRank(e+1),t.getComponent("RankItem").setName(this.friendsData[e].nickname),t.getComponent("RankItem").setChickenCount(this.friendsData[e].KVDataList[0].value),t.getComponent("RankItem").setHeadImg(this.friendsData[e].avatarUrl)}},__decorate([r(cc.Prefab)],e.prototype,"rankItem",void 0),__decorate([r(cc.Prefab)],e.prototype,"head",void 0),e=__decorate([a],e)}(cc.Component);n.default=i,cc._RF.pop()},{}],head:[function(e,t,n){"use strict";cc._RF.push(t,"ee690KEfJ1KuaXs6azYntSU","head"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.headImg=null,e}return __extends(e,t),e.prototype.setHeadImg=function(e){var n=this;if(null!=window.wx)try{var t=wx.createImage();t.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(t),e.handleLoadedTexture(),n.headImg.spriteFrame=new cc.SpriteFrame(e)}catch(e){cc.log(e),n.headImg.node.active=!1}},t.src=e}catch(e){cc.log(e),this.headImg.node.active=!1}else cc.loader.load({url:e,type:"jpg"},function(e,t){n.headImg.spriteFrame=new cc.SpriteFrame(t)})},__decorate([r(cc.Sprite)],e.prototype,"headImg",void 0),e=__decorate([a],e)}(cc.Component);n.default=i,cc._RF.pop()},{}]},{},["CanvasCtr","Rank","RankItem","head"]);