{"version":3,"sources":["RankingView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\UI\\ranking","sourcesContent":["//排行榜界面\r\n\r\nimport RankingCell from \"./RankingCell\";\r\nimport GameCtr from \"../../Controller/GameCtr\";\r\nimport WXCtr from \"../../Controller/WXCtr\";\r\nimport Http from \"../../Common/Http\";\r\nimport UserManager from \"../../Common/UserManager\";\r\nimport { UILoader } from \"../../Common/UILoader\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class RankingView extends cc.Component {\r\n    @property(cc.Node)\r\n    ndRanking: cc.Node = null\r\n    @property(cc.Sprite)\r\n    sprFreindRankScroll: cc.Sprite = null;\r\n    @property(cc.Node)\r\n    ndWorldScr: cc.Node = null;\r\n    @property(cc.Node)\r\n    ndWorldContent: cc.Node = null;\r\n    @property(cc.Prefab)\r\n    pfCell: cc.Prefab = null;\r\n    @property(cc.Toggle)\r\n    friendToggle: cc.Toggle = null;\r\n    @property(cc.Toggle)\r\n    worldToggle: cc.Toggle = null;\r\n    @property(cc.Node)\r\n    ndAuthTip: cc.Node = null;\r\n\r\n    private tex = null;\r\n    private isGetWorldList = false;\r\n    private isGetFriendList = false;\r\n    \r\n    onLoad() {\r\n        GameCtr.getInstance().setRanking(this);\r\n    }\r\n\r\n    start() {\r\n        if(window.wx != undefined){\r\n            this.tex = new cc.Texture2D();\r\n            window.sharedCanvas.width = 900;\r\n            window.sharedCanvas.height = 1200;\r\n        }\r\n        this.initRank();\r\n    }\r\n\r\n    //初始化界面\r\n    initRank() {\r\n        // if (this.friendToggle.isChecked) {\r\n        //     this.showFreindRanking();\r\n        // } else if (this.worldToggle.isChecked) {\r\n        //     this.showWorldRanking();\r\n        // }\r\n\r\n        this.showWorldRanking();\r\n    }\r\n\r\n    //返回结束\r\n    back() {\r\n        this.showAuthTip(false);\r\n        this.isGetFriendList = false;\r\n        WXCtr.closeFriendRanking();\r\n        GameCtr.gotoScene(GameCtr.rankingEntrance);\r\n    }\r\n\r\n    //显示世界排行\r\n    showWorldRanking() {\r\n        console.log('点击了世界排行榜');\r\n        this.ndWorldScr.active = true;\r\n        this.sprFreindRankScroll.node.active = false;\r\n        if (!WXCtr.wxLoginSuccess) {\r\n            console.log(\"未授权，引导获取授权！！！\");\r\n            this.showAuthTip(true);\r\n            return;\r\n        }\r\n        if (!this.isGetWorldList) {\r\n            this.getWorldRankingData();\r\n        }\r\n    }\r\n\r\n    //\r\n    showAuthTip(isShow = false) {\r\n        this.ndAuthTip.active = isShow;\r\n        if(isShow) {\r\n            WXCtr.userInfoBtn.show();\r\n        }else{\r\n            WXCtr.userInfoBtn.hide();\r\n        }\r\n    }\r\n\r\n    //获取世界排行数据\r\n    getWorldRankingData() {\r\n        console.log('获取世界排行数据???');\r\n        Http.send({\r\n            url: Http.UrlConfig.GET_RANK_LIST,\r\n            success: (resp) => {\r\n                console.log(\"getWorldList response == \", resp);\r\n                this.isGetWorldList = true;\r\n                this.setWorldList(resp.data,resp.metop,resp.metopvalue);\r\n            },\r\n            data: {\r\n                uid: UserManager.user_id,\r\n                voucher:UserManager.voucher,\r\n            }\r\n        });\r\n    }\r\n\r\n    //设置世界排行\r\n    setWorldList(worldRanks,selfRank,selfChickenValue) {\r\n        UILoader.loadRes(\"prefab/totalRank\", cc.Prefab, (prefab) => {\r\n            UILoader.instantiate(prefab, this.node, (node) => {\r\n                node.getComponent(\"totalRank\").init(worldRanks,selfRank,selfChickenValue)\r\n            });\r\n        });\r\n\r\n    }\r\n\r\n\r\n\r\n    //显示好友排行\r\n    showFreindRanking() {\r\n        this.sprFreindRankScroll.node.active = true;\r\n        this.ndWorldScr.active = false;\r\n        this.showAuthTip(false);\r\n        if (!this.isGetFriendList) {\r\n            this.isGetFriendList = true;\r\n            WXCtr.showFriendRanking();\r\n        }\r\n    }\r\n\r\n    //关闭世界排行\r\n    onCloseRank() {\r\n        this.ndRanking.active = false;\r\n    }\r\n\r\n\r\n    // 刷新子域的纹理\r\n    _updateSubDomainCanvas() {\r\n        if (window.sharedCanvas != undefined && this.tex != null && this.ndRanking.active && this.sprFreindRankScroll.node.active) {\r\n            this.tex.initWithElement(window.sharedCanvas);\r\n            this.tex.handleLoadedTexture();\r\n            this.sprFreindRankScroll.spriteFrame = new cc.SpriteFrame(this.tex);\r\n        }\r\n    }\r\n    update() {\r\n        this._updateSubDomainCanvas();\r\n    }\r\n};"]}