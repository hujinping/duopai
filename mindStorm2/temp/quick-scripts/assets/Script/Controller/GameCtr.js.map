{"version":3,"sources":["GameCtr.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Controller","sourcesContent":["//游戏全局控制类\r\nimport AudioManager from \"../Common/AudioManager\";\r\nimport UserManager from \"../Common/UserManager\";\r\nimport WXCtr from \"./WXCtr\";\r\nimport Game from \"../UI/game/Game\";\r\nimport Start from \"../UI/start/Start\";\r\nimport End from \"../UI/end/End\";\r\nimport RankingView from \"../UI/ranking/RankingView\";\r\nimport Revive from \"../UI/end/Revive\";\r\nimport HttpCtr from \"./HttpCtr\";\r\nimport Http from \"../Common/Http\";\r\n//import Collide from \"../View/game/Collide\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GameCtr {\r\n    public static ins: GameCtr;\r\n    public mGame: Game;\r\n    private mStart: Start;\r\n    private mEnd: End;\r\n    private eventTarget=null;\r\n    public mRanking: RankingView;\r\n    public static selfInfo=null;\r\n    public static isAudited= false;                     //已审核\r\n    public static reviveTimes = 0;                      //第几次复活\r\n    public static totalReviveTimes=0;                   //总复活次数\r\n    public static questionDes=\"\";                       //当前问题\r\n    public static isMatchingOver=false;\r\n    public static questionAnswer=-1;                    //当前问题答案  1 正确  2 错误\r\n    public static powerValue = 10;                      //游戏体力值\r\n    public static gameRoleCount=30;                     //游戏总人数    \r\n    public static roleTag = -1;                         //游戏角色   \r\n    public static chickenCount=-1;                      //吃鸡数量\r\n    public static joinGameCount=-1;                     //参与游戏次数\r\n    public static score: number = 0;\r\n    public static rankingEntrance = \"Start\";            //排行榜界面入口，默认开始界面\r\n    public static IPONEX_HEIGHT=2436;\r\n    public static navigatorData = null;                 //更多游戏导航数据\r\n    public static challengerData = null;                //挑战者信息\r\n    public static challengeSwitch = false;              //挑战开关(有人发起挑战时为true)\r\n    public static reviveData=null;\r\n    public static money=null;\r\n\r\n\r\n    constructor() {\r\n        GameCtr.ins = this;\r\n        WXCtr.getLaunchOptionsSync();\r\n        WXCtr.getAuthSetting();\r\n        WXCtr.showShareMenu();\r\n        WXCtr.wxOnLogin();\r\n        WXCtr.getSelfData();\r\n        this.initEventTarget();\r\n    }\r\n\r\n\r\n    static getInstance() {\r\n        if (!GameCtr.ins) {\r\n            GameCtr.ins = new GameCtr();\r\n        }\r\n        return GameCtr.ins;\r\n    }\r\n\r\n    getAdaptScaleRate(){\r\n        var visibleSize = cc.view.getFrameSize();\r\n        var height = 1920 * visibleSize.width / 1080;\r\n        var scaleRate = visibleSize.height / height;\r\n        return scaleRate;\r\n    }\r\n\r\n    initEventTarget(){\r\n        this.eventTarget=new cc.EventTarget();\r\n    }\r\n\r\n    getEventTarget(){\r\n        return this.eventTarget;\r\n    }\r\n\r\n    emitEvent(event,data){\r\n        this.eventTarget.emit(event,data);\r\n    }\r\n\r\n    addListener(event,callFunc){\r\n        this.eventTarget.on(event,callFunc);\r\n    }\r\n\r\n    removeListener(event){\r\n        this.eventTarget.off(event);\r\n    }\r\n\r\n    //设置game实例(游戏)\r\n    setGame(game: Game) {\r\n        this.mGame = game;\r\n    }\r\n    //设置start实例（开始）\r\n    setStart(start: Start) {\r\n        this.mStart = start;\r\n    }\r\n    //设置end实例（结束）\r\n    setEnd(end: End) {\r\n        this.mEnd = end;\r\n    }\r\n    //设置ranking实例（排行）\r\n    setRanking(ranking: RankingView) {\r\n        this.mRanking = ranking;\r\n    }\r\n\r\n\r\n\r\n    //场景切换\r\n    static gotoScene(sceneName) {\r\n        cc.director.loadScene(sceneName);\r\n        AudioManager.getInstance().stopAll();\r\n    }\r\n\r\n    //显示结束界面\r\n    static showEnd() {\r\n        GameCtr.gotoScene(\"End\");\r\n    }\r\n\r\n    //显示开始界面\r\n    static showStart() {\r\n        GameCtr.gotoScene(\"Start\");\r\n    }\r\n\r\n    // 显示最想王者\r\n    static showStrongest() {\r\n        GameCtr.gotoScene(\"Strongest\");\r\n    }\r\n\r\n    //显示复活界面\r\n    static showRevive() {\r\n        if(GameCtr.ins){\r\n            GameCtr.ins.mGame.showRevive();\r\n        }\r\n    }\r\n\r\n    \r\n    //开始游戏\r\n    static startGame() {\r\n        GameCtr.score = 0;\r\n        GameCtr.gotoScene(\"Game\");\r\n    }\r\n\r\n    //显示排行榜\r\n    static showRanking(entrance) {\r\n        GameCtr.rankingEntrance = entrance;\r\n        GameCtr.gotoScene(\"Ranking\");\r\n    }\r\n\r\n    //复活继续游戏\r\n    static revive() {\r\n        //GameCtr.surplusReviveTimes--;\r\n        //复活逻辑自己处理...\r\n    }\r\n\r\n\r\n    //播放背景音乐\r\n    static playBgm() {\r\n        // AudioManager.getInstance().playMusic(\"audio/bgm\", true, 1); \r\n    }\r\n\r\n    //增加分数\r\n    static addScore(num) {\r\n        if (GameCtr.ins) {\r\n            GameCtr.score += num;\r\n        }\r\n    }\r\n\r\n    //游戏结束\r\n    static gameOver() {\r\n        if (GameCtr.ins) {\r\n            WXCtr.submitScoreToWx(GameCtr.score);\r\n            HttpCtr.sendScore();\r\n            // if(GameCtr.surplusReviveTimes > 0) {\r\n            //     GameCtr.showRevive();\r\n            // }\r\n        }\r\n    }\r\n\r\n    saveSelfInfoToLocal(info){\r\n        let selfInfo={\r\n            avatarUrl: info.avatarUrl,\r\n            city: info.city,\r\n            country: info.country,\r\n            gender: info.gender,\r\n            language: info.language,\r\n            nickName: info.nickName,\r\n            province: info.province,\r\n        }\r\n        \r\n        window.localStorage.setItem(\"selfInfo\",JSON.stringify(selfInfo))\r\n    }\r\n\r\n    getSelfInfoFromLocal(){\r\n        let selfInfo=window.localStorage.getItem(\"selfInfo\");\r\n        if(!selfInfo){return};\r\n        return JSON.parse(selfInfo);\r\n    }\r\n\r\n    //分享到群检测\r\n    static shareGroupCheck(encryptedData, iv,type) {\r\n        Http.send({\r\n            url: Http.UrlConfig.SHARE_GROUP,\r\n            data: {\r\n                user_id: UserManager.user_id,\r\n                encrypted_data: encryptedData,\r\n                iv: iv\r\n            },\r\n            success: (resp) => {\r\n                console.log(\"分享到群成功\", resp);\r\n                console.log(resp.code == 403);\r\n                if (resp.code == 200) {\r\n                    // console.log('走到200');\r\n                    // if(type=='collide'){\r\n                    //     GameCtr.ins.mCollide.shareOk()\r\n                    // }else{\r\n                    //     GameCtr.getGold(\"group\");\r\n                    // }\r\n                } else if (resp.code == 403) {\r\n                    // if(type == 'collide'){\r\n                    //     console.log('222222222')\r\n                    //     GameCtr.shareTip('今天已分享过该群，暂无奖励');\r\n                    // }else{\r\n                    //     GameCtr.reviveTip(\"今天已经分享过这个了！\");\r\n                    // }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n"]}