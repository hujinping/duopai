{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Common/assets\\Script\\Common\\MemoryDetector.ts"],"names":[],"mappings":";;;;;AACM,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAQ,CAAkB;AAE1C;IAAA;IA6DA,CAAC;uBA7DY,cAAc;IAIT,+BAAgB,GAA9B;QACI,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,OAAO;SACV;QAED,IAAI,gBAAc,CAAC,OAAO,EAAE;YACxB,OAAO;SACV;QAED,IAAI,SAAS,GAAG,IAAI,CAAC;QACrB,IAAI,QAAQ,GAAG,EAAE,CAAC,UAAU,CAAC,CAAC;QAC9B,uBAAuB;QAEvB,IAAI,cAAc,GAAG;YACjB,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC1C,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;YAC/C,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;YAErC,IAAI,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC;YAC5B,KAAK,CAAC,KAAK,GAAG,kBAAkB,CAAC;YACjC,KAAK,CAAC,IAAI,GAAG,4BAA4B,CAAC;YAC1C,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC;YAC3B,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YACrB,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;QACzC,CAAC,CAAA;QAED,mBAAmB;QAEnB,IAAI,UAAU,GAAG;YACb,IAAI,KAAK,GAAG,CAAC,CAAC;YACd,IAAI,UAAU,GAAG,CAAC,CAAC;YACnB,IAAI,UAAU,GAAG,EAAE,CAAC,YAAY,CAAC,WAAW,CAAC,CAAC;YAE9C,KAAK,IAAI,GAAG,IAAI,UAAU,EAAE;gBACxB,IAAI,UAAU,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC;gBACjC,KAAK,EAAE,CAAC;gBACR,UAAU,IAAI,UAAU,CAAC,aAAa,EAAE,GAAG,UAAU,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC;aAC9E;YAED,IAAI,qBAAqB,GAAG,EAAE,CAAC,YAAY,CAAC,qBAAqB,CAAC,CAAC;YAEnE,KAAK,IAAI,GAAG,IAAI,qBAAqB,EAAE;gBACnC,IAAI,kBAAkB,GAAG,qBAAqB,CAAC,GAAG,CAAC,CAAC;gBACpD,KAAK,IAAI,YAAY,IAAI,kBAAkB,EAAE;oBACzC,IAAI,SAAS,GAAG,kBAAkB,CAAC,YAAY,CAAC,CAAC;oBACjD,KAAK,EAAE,CAAC;oBACR,UAAU,IAAI,SAAS,CAAC,KAAK,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;iBACxD;aACJ;YAED,0FAA0F;YAC1F,OAAO,CAAC,GAAG,CAAC,oCAAoC,EAAC,CAAC,UAAU,GAAG,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAC,GAAG,CAAC,CAAC;QACtG,CAAC,CAAA;QAED,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,EAAE,CAAC,QAAQ,CAAC,iBAAiB,EAAE,UAAU,CAAC,CAAC;QAC1D,gBAAc,CAAC,OAAO,GAAG,IAAI,CAAC;IAClC,CAAC;IA1De,sBAAO,GAAa,KAAK,CAAC;IAFjC,cAAc;QAD1B,OAAO;OACK,cAAc,CA6D1B;IAAD,qBAAC;;CA7DD,AA6DC,IAAA;AA7DY,wCAAc","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Common","sourcesContent":["\r\nconst {ccclass, property} = cc._decorator;\r\n@ccclass\r\nexport class MemoryDetector {\r\n\r\n    private  static _inited : boolean = false;\r\n\r\n    public static showMemoryStatus() : void  {\r\n        if (cc.sys.isNative) {\r\n            return;\r\n        }\r\n\r\n        if (MemoryDetector._inited) {\r\n            return;\r\n        }\r\n\r\n        let _memLabel = null;\r\n        let profiler = cc[\"profiler\"];\r\n        //profiler.showStats();\r\n\r\n        let createMemLabel = function () {\r\n            _memLabel = document.createElement('div');\r\n            profiler._fps = document.getElementById('fps');\r\n            profiler._fps.style.height = '100px';\r\n\r\n            let style = _memLabel.style;\r\n            style.color = 'rgb(0, 255, 255)';\r\n            style.font = 'bold 12px Helvetica, Arial';\r\n            style.lineHeight = '20px;';\r\n            style.width = '100%';\r\n            profiler._fps.appendChild(_memLabel);\r\n        }\r\n\r\n        //createMemLabel();\r\n\r\n        let afterVisit = function () {\r\n            let count = 0;\r\n            let totalBytes = 0;\r\n            let locTexrues = cc.textureCache[\"_textures\"];\r\n\r\n            for (let key in locTexrues) {\r\n                let selTexture = locTexrues[key];\r\n                count++;\r\n                totalBytes += selTexture.getPixelWidth() * selTexture.getPixelHeight() * 4;\r\n            }\r\n\r\n            let locTextureColorsCache = cc.textureCache[\"_textureColorsCache\"];\r\n\r\n            for (let key in locTextureColorsCache) {\r\n                let selCanvasColorsArr = locTextureColorsCache[key];\r\n                for (let selCanvasKey in selCanvasColorsArr) {\r\n                    let selCanvas = selCanvasColorsArr[selCanvasKey];\r\n                    count++;\r\n                    totalBytes += selCanvas.width * selCanvas.height * 4;\r\n                }\r\n            }\r\n            \r\n            //_memLabel.innerHTML = \"  Memory  \" + (totalBytes / (1024.0 * 1024.0)).toFixed(2) + \" M\";\r\n            console.log(\"log-----------------------memory=:\",(totalBytes / (1024.0 * 1024.0)).toFixed(2)+\"M\");\r\n        }\r\n\r\n        cc.director.on(cc.Director.EVENT_AFTER_VISIT, afterVisit);\r\n        MemoryDetector._inited = true;\r\n    }\r\n}\r\n"]}